## This is Ramon's log

- [2023-11-14 12:46:40] back after a meeting and breakfast
  - so, now I need to fix the bugs below, let's start with the victory banner, that should be easy
  - it was easy! ok now try to replicate the second bug; I have it again, so what is it?
  - I think I know what it is: the conversation and author ids are global, so they end up mixing across worlds
- [2023-11-14 10:25:05] ok, I have the basic logic for multiplayer, time to test
  - BUG: clear leakage of prior conversations, f-me
  - BUG: game does end when there is a last human, but the victory banner is not there :( [done]
- [2023-11-13 12:28:21] I can start a game, but it still has the cooperative version (which we can bring back?) time to chagne the game conditions to match the Hv.H
  - if reported, human loses, his player is removed -> callback after report [done]
  - if gets secret code, human wins and game ends -> normal game result [done]
  - if last human, human wins and game ends -> callback after report? [done]
  - need to change the status of the game so the banner shows who won or if you lost [done]
- [2023-11-13 12:03:53] I have a janky lobby system, but the returend game is all wrong, going to check that
- [2023-11-12 13:24:15] ok, now let's do the lobby room functionality, this should
  - provide a button to create a new lobby [done]
  - provide a button to join someone's lobby [done]
  - when you create a lobby, you should remove the default world and it should take you to there
  - a view of the lobby, with the users  [done]
- [2023-11-12 11:18:54] back after a day break, I want to create the custom init, it should
  - check who is in the party [done]
  - remove their default worlds [done]
  - create a new world [done]
  - allocate secret code at random [done]
  - allocate human characters at random [done]
  - instantiate agents and players [done]
  - set new world as default for users [done]
- [2023-11-10 17:05:31] ok now I need to be able to create multi-player game from init
  - create a lobby schema [done]
  - this may require a different init? [done]
  - the init should be initiated from who is in the lobby, so maybe create a notion of a "party"?
  - when the party is all there, then you can start the game, which then goes to `initMultiPlayerGame` and assigns the players to characters
  - max the lobby at 3?
- [2023-11-10 16:22:49] moving to multiplayer, I am going to first
  - change the worldStatus to mark if it multiplayer or solo [done]
  - create a user table that has the current default world and other goodies if necessary [done]
- [2023-11-10 10:28:10] never mind the share code functionality isn't working [done]
  - we need to update player state via input handlers
  - it works now!
- [2023-11-10 10:25:02] the game is in an ok condition, and the functionality is there, but I did see some issues
- [2023-11-10 07:42:55] there are two janequants, woups!
  - lol and we share the same character! so I need to _not_ create a character when the human is created
  - I did not see a rejection in my memory log, rejections are _not_ working; they are definitely not working on the receiving side [done]
  - and the character dissapears out of no where, why?! For whatever reason my character dissapears after a bit... why!? apparently there is a idle timer that boots the human [done]
  - I need to remove activities, well just reduced them to very little [done]
- [2023-11-09 20:33:14] Ok, almost there, map needs to be fixed and some details
- [2023-11-09 19:58:25] I think I have most of it there, probably will need to give ita pass once I try to run it
- [2023-11-09 15:02:56] this is a very long merge, painful
  - sorted out the memory clashes
  - sorted out some random clashes
  - sorted out the remember rejection stuff
  - working on the replanning; I am going to make it such that after every conversation you have to replan, similar to remember; super inefficient but will come back to it [done]
  - I don't know what is of the status of conversation members schema, is that a thing? , will check later; ah! so they just don't exist, they get deleted [done]
  - this one is tricky, I need to set the game ending conditions again
     - I am not super familiar with how the system _actually_ works so I am assuming setting a variable propagates? 
  - ok I think I have the game conditions set, at least the function calls
- [2023-11-07 12:59:59] Going to start the mega-merge, which will be very painfull. To do so I will first try it in a separate branch.
- [2023-11-07 12:59:17] I had to fix some random bugs, but now rejections are recorded regardless of whether the human or the AI is the one that rejects, and the AI takes them into consideration. This is still crude but works!
- [2023-11-06 08:54:51] resuming working on having human rejections be recorded. I think I may need to just handle this as part of the input handling, that way it covers human and agent rejections; actually no, its better to keep it as part of the agent loop; because otherwise we are putting agent logic on the game logic and we want that to be separate; I think what I am going to do is to have a "rejected" status that is like "left".
  - I added the rejected state and the check to see if it should be remembered, it is inefficient now since it always checks all past memories, should be better;
  - I need to add a cooldown after rejection, lol, otherwise they keep pestering [done]
- [2023-11-05 09:20:17] I noticed a weird bug where the bots stayed in limbo after sharing the code, namely:
  - leosky stood there doing nothing, seems like it was trying to wander? I think it was trying to reflect but the conversation was still ongoing
- [2023-11-04 18:25:40] Going to add rejected conversations to "events", idea being that this should inform AIs when someone is avoiding it
  - probably as a callback from reject [done]
  - then make sure to reflect on rejected memories [done]
  - adjust the remember conversation so that conversations that were rejected get engraved as memories (or maybe something else?) [done]
  - you need a callback for when the human rejects
- [2023-11-03 15:15:23] I've added the functionality for adding events to memories, including sharing/reporting events. I now want to add eavesdropping events!
  - need to check for nearby players that are also in mid conversation
  - then trigger memory for the eaves dropped 
  - and trigger 'overheard' memory for the one that passed by
- [2023-11-03 12:12:14] after a hiatus, I am back! resuming the memory stuff below
- [2023-10-30 14:06:24] ok, now I need to record a memory every time that someone gets reported / code shared
  - I need to first clean when we are able to report / share, seems like we are not allowing it at the beginning of the conversation [done]
  - I need to then add it as a side effect (?) or as an action to do for the agent to do? Oh, maybe I can make it a check in the agent loop [done]
  - then we need to surface the action in the conversation whenever it is relevant, so this needs to be checked as well [done]
- [2023-10-30 12:27:05] the issue with the agents that keep pinging the schedule is that disabling a player does not stop the agent, so I need to _also_ stop the agent. [done]
- [2023-10-30 07:48:03] Issues:
  - I need to pass actions as memories, for example reporting / sharing, eavesdropping, etc.
  - They revert to bloviating when the plan is updated, instead of intently asking for the code
- [2023-10-30 06:39:32] I have the issue where they are not updating the plans... I think is a timeout issue I am going to increase the timeout for it
  - I am still seeing it...
  - Going to check if the plan is actually being written 
  - ok, so the issue is indeed a timeout [done]
  - yes it was a timeout, I solved that but now I need to make it async, and I don't know if that actually works [done]
- [2023-10-30 06:07:39] back at it, trying to address the reflect and replan process
- [2023-10-29 19:40:19] I have implemented the reflection and replanning process, but its not perfect:
  - plans and reflections are unnecessarily long
  - we still have agents reflecting even after they have been booted, which means we didn't stop them correctly
  - the plans are very vague
  - I need to explicitly call for giving the whole plan not just the update because some plans look like an addendum
  - the time stamps on the reflection and replaninng are in unix not in date strings [done]
- [2023-10-29 16:52:16] I am having a generator issue, tons of "agent generation number is not equal to ___", I need to debug this.
  - I am going to remove the replan stuff, if the problem persist then the issue is elsewhere, if not then something in my update plan code throws the numbering off
  - so it is that, gonna try moving it as its own action then.
- [2023-10-27 09:59:48] The AIs still feel like they are missing intent, I am going to try to update their plan.
  - Let them update their plan periodically (maybe after every conversation? Or maybe as part of the reflection system?)
  - The updated plan has a hard coded part (which depends on whether they have the code, and a dynamic one which they write into).
  - I am going to do this as a reflection mechanism that gets triggered every time a conversation is remembered.
  - the function should be "replan", use the latest conversation memories and prior plans, and replan
- [2023-10-27 09:49:42] even if both know that they are certified AIs they still do the ceremonial code sharing thing. I am just going to remove the option.
- [2023-10-27 09:21:35] so one of the issues of the game is that AIs with the code keep reporting each other as human. The interaction is weird because they should know that the other has the code. Options:
  - Explicitly state that the other has the code, in which case their conversation should be different?
    - I am going to go for this for now and see how it goes. [done]
  - Just remove the ability to report and share? [done]
  - leave as is, but improve the memory system so that they recall when they gave / received the code from someone?
- [2023-10-22 17:10:57] I am going to change how we log function calls, since if I want to later finetune I may want the output to match
- [2023-10-20 13:14:21] it is sort of working, but I think when you reach a victory condition it doesn't allow you to play again. Time to debug!
  - solved it was a bug with the default flag
- [2023-10-20 12:07:29] when I create a game for the first time I don't get the human to play, why is that?
- [2023-10-20 12:01:29] I can start a game, and have multiple players but I still only see the first default game, fixing it; 
  - Fixed! I only get the game for your particular user
- [2023-10-19 15:26:39] I removed the convex/a16z banner as well as the pointer to AI Town. I should add the pointer to AI town at some point.
- [2023-10-18 10:24:11] Ok, trying to resume, this is what I want to do today:
  - associate each world to a player [done]
    - identity.subject gives me the user id from clerk [done]
  - create a new game for each player (so each player has an associated game) [done]
  - cap number of players in a given game (start with 1) [done]
  - AIs should know if both of them have the code
  - pass the world id to clem logger [done]
  - move the recent events so that they are `inputs` that way conversations actually end gracefully and we do everything through inputs
- [2023-10-17 12:50:38] alright, I think I have to make the call-backs _after_ the conversation message is sent so that it finishes.
- [2023-10-16 15:36:08] I tried simply deactivating players, but that keeps them in a limbo so that's not going to fly
- [2023-10-16 13:21:15] Boot AIs that have been reported as human
  - hook that disables a player
  - a banner that shows that a player was booted
- [2023-10-16 12:24:14] Ok, now I have implemented 2 of the 3 end game conditions; the problem with the third is that I don't think is well designed:
  - if its by majority of total number AIs, then if the code-holder starts reporting aggressively this condition may not be achievable and will be the equivalent of not existing
  - if it doesn't exist, then the incentive for Zara is to just keep reporting
  - if its by existing majority then at some point the incentive reverts to just reporting (e.g. get at least 1 AI then report everyone)
  - So what is a proper incentive for Zara to share the code?
- [2023-10-16 07:11:10] Alright, so I want to code that when the human gets the code:
  - the game stops (use the same functionality as init:stop and just use a different status) [done]
  - a banner appears that "human victory!" [done]
- [2023-10-15 22:13:00] fixed that, and it works! for tomorrow, I need to add the victory conditions and show some sort of pop up:
  - human has the code, human wins [done]
  - all ai have the code, ai wins (actually, this is not a good idea because you could win by reporting whomever, so perhaps only reported human?)
  - human has been found and reported [done]
- [2023-10-15 20:12:28] now I have to fix the human interaction since it broke when I added the new fields
- [2023-10-15 20:10:21] Fantastic! So i had a bug where i was never passing the share code function, but now it works, zaranova shared it with maxfusion but reported leosky
- [2023-10-15 20:02:41] actually, zaranova gave him the code, why did not call the function? I may need to have a call back ... sigh
- [2023-10-15 20:00:54] interestingly, maxfusion outright asked for the code, and zaranova behaved as if she did not have it? prompting is going to be a bitch
- [2023-10-15 19:48:33] ok, so now we have the report and share functionality, although we have not seen any code sharing, now we need to propagate the repercussions (i.e. if you are reported you should be expelled)
- [2023-10-15 14:06:04] Resuming the work, I don't know if I want to make the code sharing an explicit function call or if it should implicit. I think it should be an explicit choice by the LLM. Roughly, always offer the option of sharing the code / or report human (if the AI has the code). That way the AI knows the implications.
- [2023-10-12 10:36:21] Adding the table that has the state for the zetamaster [done]
- [2023-10-12 10:29:12] Going to work on the path for being able to declare someone as human, which requires an AI to have the code. So first, let's build the following features:
  - Keep track of which players have the zetamaster [done]
  - Keep track of which players have been declared as human [done]
  - Offer the LLM the "functions" to share code / report as human. [done]
  - Allow action to declare a player human if you have the code [done]
  - Callback to action that stores that in the system [done]
  - End game if human player is reported